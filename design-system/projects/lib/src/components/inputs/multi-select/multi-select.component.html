<div #multiselect class="pm-multi-select cursor-pointer border-radius-{{borderRadius}}" (click)="$event.stopPropagation(); openSelect()">
  <div class="d-flex flex-wrap p-1 rad-md position-relative">
    <div class="d-flex flex-row justify-content-start flex-wrap">
      <div *ngFor="let selected of _selectedOptions; let first = first" [ngClass]="{'m-1 chip-container': true}">
        <div class="d-flex flex-row align-items-center">
          <ng-container *ngTemplateOutlet="thumbnailContainer; context: {$implicit: selected, marginStart: true}"></ng-container>
          <p class="m-0 ms-1">{{selected.label}}</p>
          <button class="btn btn-light" (click)="removeSelectedOption(selected)">x</button>
        </div>
      </div>
    </div>
    <form>
      <input #inputBox
             #trigger="matAutocompleteTrigger"
             matInput
             class="form-control h-100 border-0"
             type="text"
             [formControl]="myControl"
             [placeholder]="placeholder"
             [matAutocomplete]="auto"
      >

      <mat-autocomplete #auto="matAutocomplete"
                        (optionSelected)="selectOption($event.option.value);"
                        [panelWidth]="multiselect.offsetWidth"
      >
        <ng-container *ngFor="let option of filteredOptions | async">
          <mat-option
            [hidden]="isOptionSelected(option)"
            [value]="option"
          >
            <div class="d-flex flex-row align-items-center">
              <ng-container *ngTemplateOutlet="thumbnailContainer; context: {$implicit: option}"></ng-container>
              <span class="color-gray-dark" [ngClass]="{'ms-2': option?.thumbnail}">{{option.label}}</span>
            </div>
          </mat-option>
        </ng-container>
      </mat-autocomplete>
    </form>
    <i class="position-absolute uil uil-lg uil-angle-down"></i>
  </div>
</div>

<ng-template #thumbnailContainer let-option let-marginStart="marginStart">
  <div *ngIf="option?.thumbnail" class="pm-multi-select-thumbnail-container" [ngClass]="{'ms-2': marginStart, 'circular': !roundedThumbnail, 'mx-2': roundedThumbnail}">
    <img
      aria-hidden
      [src]="option.thumbnail"
      height="25"
    >
  </div>
</ng-template>
